(()=>{"use strict";console.log("JS  loaded!");const t=document.querySelector(".cart-products"),e=document.querySelector(".freight-cost_b"),s=document.querySelector(".total-cost_b"),n=document.querySelectorAll(".step"),a=document.querySelectorAll(".part"),r=document.getElementById("shipping-way"),i=document.getElementById("buttons-control"),c=i.querySelector(".btn-outline"),o=i.querySelector(".btn-primary"),l={step:0,selectedShippingCost:"",shippingWays:[{id:1,way:"標準運送",description:"約 3-7 個工作天",cost:0},{id:2,way:"DHL 貨櫃",description:"48 小時內送達",cost:500}],cartItems:[{id:1,name:"破壞補丁修身牛仔褲",image:"src/img/product_one.png",amount:1,price:3999,subtotal:""},{id:2,name:"刷色直筒牛仔褲",image:"src/img/product_two.png",amount:1,price:1299,subtotal:""}],calcSubtotal(t){t.subtotal=t.amount*t.price},setFreightCost(t){t.cost=0!==Number(t.cost)?`$${t.cost}`:"免費"},changeAmount(t,e){const s=this.cartItems.find((e=>e.id===Number(t)));"plus"===e?s.amount++:"minus"===e&&s.amount>0&&s.amount--,this.calcSubtotal(s)},cartTotal(){return this.cartItems.reduce(((t,e)=>t+e.subtotal),0)+this.selectedShippingCost}},d={renderCartList(){let e="";l.cartItems.forEach((t=>{l.calcSubtotal(t),e+=`\n        <div class="c-product-card w-100 mb-4 d-flex">\n          <div class="c-product-img">\n            <img src="${t.image}" alt="">\n          </div>\n          <div class="c-product-info d-grid justify-content-end align-items-center">\n            <p class="c-product-name">${t.name}</p>              \n            <div class="c-product-qty d-flex align-items-center" data-id="${t.id}">\n              <button class="btn btn-minus"><i class="fas fa-minus"></i></button>\n              <span class="c-product-qty_amount"> ${t.amount}</span>\n              <button class="btn btn-plus"><i class="fas fa-plus"></i></button>\n            </div>\n            <b class="c-product-price price"> $${t.subtotal.toLocaleString("en-US")}</b>\n          </div>\n        </div>\n      `})),t.innerHTML=e},renderCartFreightCost(t){e.innerText=t},renderCartTotal(){s.innerText=`$${l.cartTotal().toLocaleString("en-US")}`},renderShippingWays(){let t="";l.shippingWays.forEach((e=>{l.setFreightCost(e),t+=`\n        <div class="form-wrap" data-id="${e.id}">\n          <input name="shipping-type" type="radio" value="dhl-container">\n          <div class="shipping-type-desc">\n            <label>${e.way}</label>\n            <p>${e.description}</p>\n          </div>\n          <div class="shipping-type-cost">${e.cost}</div>\n        </div>\n      `})),r.innerHTML=t},renderFormPart(t,e){a[t].classList.toggle("d-none"),a[e].classList.toggle("d-none")},setStepperStatus(t,e){const s=n[t];if("next"===e){const e=n[t+1];s.classList.remove("active"),s.classList.add("checked"),e.classList.add("active")}else{const e=n[t-1];s.classList.remove("active"),e.classList.remove("checked"),e.classList.add("active")}},setBtnStatus(){0===l.step?c.classList.add("d-none"):c.classList.remove("d-none"),l.step===a.length-1?o.innerHTML="確認下單":o.innerHTML='下一步<img src="./src/img/arrow-right.png" class="ml-3"></button>'},setWrapActive(){for(let t of r.children)t.firstElementChild.checked?t.classList.add("active"):t.classList.remove("active")}},p={setSite(){d.renderShippingWays(),d.renderCartList(),d.renderCartTotal()},changeCartAmount(t,e){l.changeAmount(t,e),d.renderCartList(),d.renderCartTotal()},changeStep(t){t.target===o&&"下一步"===t.target.innerText?(d.setStepperStatus(l.step,"next"),d.renderFormPart(l.step,l.step+1),l.step++):t.target===c.firstElementChild&&(d.setStepperStatus(l.step,"prev"),d.renderFormPart(l.step,l.step-1),l.step--),d.setBtnStatus()},selectShippingWay(t){const e=Number(t.dataset.id),s=t.lastElementChild.innerText;l.selectedShippingCost=1===e?0:500,d.setWrapActive(),d.renderCartFreightCost(s),d.renderCartTotal()}};t.addEventListener("click",(t=>{const e=t.target.closest(".btn"),s=e.parentElement.dataset.id;e.matches(".btn-plus")&&p.changeCartAmount(s,"plus"),e.matches(".btn-minus")&&p.changeCartAmount(s,"minus")})),i.addEventListener("click",(t=>{t.preventDefault(),p.changeStep(t)})),r.addEventListener("click",(t=>{"INPUT"===t.target.tagName&&p.selectShippingWay(t.target.parentElement)})),p.setSite()})();